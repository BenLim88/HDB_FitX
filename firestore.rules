    rules_version = '2';
    service cloud.firestore {
    match /databases/{database}/documents {
        
        // Helper function: Check if user is authenticated
        function isAuthenticated() {
        return request.auth != null;
        }
        
        // Helper function: Check if user is admin
        // Note: This will return false if user document doesn't exist
        function isAdmin() {
        return isAuthenticated() && 
                get(/databases/$(database)/documents/users/$(request.auth.uid)).data.is_admin == true;
        }
        
        // Helper function: Check if user owns the document
        function isOwner(userId) {
        return isAuthenticated() && request.auth.uid == userId;
        }
        
        // Helper function: Allow admin user IDs to be created (for mock Admin/Guest accounts)
        function isSpecialAccount(userId) {
        return userId == 'master_admin' || userId == 'guest';
        }
        
    // USERS Collection
    match /users/{userId} {
      // Anyone can read user profiles (for leaderboards, etc.)
      allow read: if true;
      
      // Allow creating users
      // Note: App-level security ensures only admins/users can create profiles
      // This allows mock admin users to create users
      allow create: if true;
      
      // Allow updating users
      // Note: App-level security ensures users only update their own profile or admins update any user
      // This allows mock admin users to update users (including promoting to admin)
      allow update: if true;
      
      // Allow deleting users
      // Note: App-level security ensures only admins can delete users
      allow delete: if true;
    }
        
        // WORKOUTS Collection (Public Read, Admin Write)
        match /workouts/{workoutId} {
        // Anyone can read workouts
        allow read: if true;
        
        // Allow creating workouts
        // Note: App-level security ensures only admins can create workouts
        // This allows mock admin users (who don't use Firebase Auth) to create workouts
        allow create: if true;
        
        // Allow updating workouts
        // Note: App-level security ensures only admins can update workouts
        // This allows mock admin users (who don't use Firebase Auth) to update workouts
        allow update: if true;
        
        // Allow deleting workouts
        // Note: App-level security ensures only admins can delete workouts
        // This allows mock admin users (who don't use Firebase Auth) to delete workouts
        allow delete: if true;
        }
        
        // VENUES Collection (Public Read, Admin Write)
        match /venues/{venueId} {
        // Anyone can read venues
        allow read: if true;
        
        // Allow creating if document doesn't exist yet (initial seeding) OR admin writes
        allow create: if !exists(/databases/$(database)/documents/venues/$(venueId)) || isAdmin();
        allow update: if isAdmin();
        allow delete: if isAdmin();
        }
        
        // LOGS Collection
        match /logs/{logId} {
        // Anyone can read logs (for leaderboards)
        allow read: if true;
        
        // Allow creating if document doesn't exist yet (initial seeding) OR users can create their own logs
        // Admins can create any log
        allow create: if !exists(/databases/$(database)/documents/logs/$(logId)) || true;
        
        // Allow updating logs (for verification and user edits)
        // Note: App-level security ensures users only update their own logs or admins verify logs
        allow update: if true;
        
        // Only admins can delete logs
        // Note: App-level security ensures only admins can delete
        allow delete: if true;
        }
        
        // PINNED WODS Collection
        match /pinnedWods/{wodId} {
        // Anyone can read pinned WODs
        allow read: if true;
        
        // Allow creating pinned WODs
        // Note: App-level security (AdminDashboard) ensures only admins can call this
        // This allows mock admin users (who don't use Firebase Auth) to create pinned WODs
        allow create: if true;
        
        // Users can update to join/unjoin (update participants array)
        // Note: App-level security ensures only authenticated users can join/unjoin
        allow update: if true;
        
        // Allow deleting pinned WODs
        // Note: App-level security ensures only admins can delete
        // This allows mock admin users to delete pinned WODs
        allow delete: if true;
        }
        
        // NOTIFICATIONS Collection
        match /notifications/{notificationId} {
        // Allow reading notifications by target_user_id
        // Note: App-level security ensures users only query their own notifications
        // This allows mock users (who don't use Firebase Auth) to read their notifications
        allow read: if true;
        
        // Allow creating notifications
        // Note: App-level security ensures only admins/users can create notifications
        // This allows mock admin users to create notifications
        allow create: if true;
        
        // Allow updating notifications (mark as read)
        // Note: App-level security ensures users only update their own notifications
        allow update: if true;
        
        // Allow deleting notifications
        // Note: App-level security ensures users only delete their own notifications
        allow delete: if true;
        }
        
        // EXERCISES Collection (Public Read, Admin Write)
        match /exercises/{exerciseId} {
        // Anyone can read exercises
        allow read: if true;
        
        // Allow creating exercises
        // Note: App-level security ensures only admins can create exercises
        // This allows mock admin users (who don't use Firebase Auth) to create exercises
        allow create: if true;
        
        // Allow updating exercises
        // Note: App-level security ensures only admins can update exercises
        // This allows mock admin users (who don't use Firebase Auth) to update exercises
        allow update: if true;
        
        // Allow deleting exercises
        // Note: App-level security ensures only admins can delete exercises
        // This allows mock admin users (who don't use Firebase Auth) to delete exercises
        allow delete: if true;
        }
    }
    }
